#include <stdio.h>
#include "Xsocket.h"

#define PASS 1
#define FAIL 0

typedef struct {
	int expected;
	char *str;
} Tests;

Tests xtests[] = {
	{ PASS, "AD:0987654321098765432109876543210987654321" },
	{ PASS, "HID:1111111111111111111111111111111111111111" },
	{ PASS, "HID:01234567890abcdefABCDEF11111111111111111" },
	{ FAIL, "HID: 01234567890abcdefABCDEF11111111111111111" },
	{ FAIL, "1234567890123456789012345678901234567890" },
	{ FAIL, "AD" },
	{ FAIL, "AD:" },
	{ FAIL, "AD:0123456789abcdef" },
	{ FAIL, ":1234567890123456789012345678901234567890" },
	{ FAIL, "HID:01234567890abcdefABCDEFGHIJKLMNOPQRSTUVW" }
};

Tests dtests[] = {
	{ PASS, "RE AD:1234567890123456789012345678901234567890" },
	{ PASS, "RE AD:1234567890123456789012345678901234567890 AD:1234567890123456789012345678901234567890" },
	{ PASS, "RE AD:1234567890123456789012345678901234567890 AD:1234567890123456789012345678901234567890 AD:1234567890123456789012345678901234567890" },
	{ PASS, "RE ( AD:1234567890123456789012345678901234567890 ) AD:1234567890123456789012345678901234567890 AD:1234567890123456789012345678901234567890" },
	{ PASS, "RE ( AD:1234567890123456789012345678901234567890  AD:1234567890123456789012345678901234567890 AD:1234567890123456789012345678901234567890 )" },
	{ PASS, "RE ( ( AD:1234567890123456789012345678901234567890 ) AD:1234567890123456789012345678901234567890 ) AD:1234567890123456789012345678901234567890" },
	{ FAIL, "RE ( AD:1234567890123456789012345678901234567890) AD:1234567890123456789012345678901234567890 AD:1234567890123456789012345678901234567890" },
	{ FAIL, "RE ( AD:1234567890123456789012345678901234567890 AD:1234567890123456789012345678901234567890 AD:1234567890123456789012345678901234567890" },
	{ FAIL, "RE AD:1234567890123456789012345678901234567890 ) AD:1234567890123456789012345678901234567890 AD:1234567890123456789012345678901234567890" },
	{ FAIL, "RE ( AD:1234567890123456789012345678901234567890 ) AD:1234567890123456789012345678901234567890 AD:BADDAG" },
};

int main()
{
	unsigned i;
	int passed;
	const char *p;

	for (i = 0; i < sizeof(xtests)/sizeof(Tests); i++) {
		
		p = xtests[i].str;
		passed = (checkXid(p, NULL) == xtests[i].expected);

		printf("XID Test %d: %s\n", i, passed ? "PASS" : "FAIL");
		if (!passed)
			exit(-1);
	}

	passed = checkXid(xtests[0].str, "AD:");
	printf("XID Test %d: %s\n", i++, passed ? "PASS" : "FAIL");
	if (!passed)
		exit(-1);

	passed = !checkXid(xtests[0].str, "HID:");
	printf("XID Test %d: %s\n", i++, passed ? "PASS" : "FAIL");
	if (!passed)
		exit(-1);




	for (i = 0; i < sizeof(dtests)/sizeof(Tests); i++) {
		
		p = dtests[i].str;
		passed = (checkDag(p) == dtests[i].expected);

		printf("DAG Test %d: %s\n", i, passed ? "PASS" : "FAIL");
		if (!passed)
			exit(-1);
	}

	printf("all tests successful\n");
	return 0;
}